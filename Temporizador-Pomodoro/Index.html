<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Elite Fluid</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* --- ESTILOS BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; user-select: none; }

        body {
            height: 100vh;
            display: flex; justify-content: center; align-items: center;
            background-color: #050505;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            font-family: 'Montserrat', sans-serif;
            color: white; overflow: hidden;
        }

        /* --- TARJETA PRINCIPAL --- */
        .dashboard {
            position: relative;
            background: rgba(20, 20, 20, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 30px;
            padding: 40px;
            width: 480px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            text-align: center; z-index: 10;
        }

        /* Luz superior decorativa - Transici√≥n suave */
        .dashboard::before {
            content: '';
            position: absolute; top: -2px; left: 50%; transform: translateX(-50%);
            width: 60%; height: 4px;
            background: linear-gradient(90deg, transparent, #00ff88, transparent);
            border-radius: 10px;
            box-shadow: 0 0 20px #00ff88;
            transition: all 0.8s ease; /* Transici√≥n suave de luz */
        }

        .dashboard.break-mode::before {
            background: linear-gradient(90deg, transparent, #00d2ff, transparent);
            box-shadow: 0 0 20px #00d2ff;
        }

        /* --- RELOJ CIRCULAR SVG --- */
        .timer-container {
            position: relative; width: 280px; height: 280px;
            margin: 0 auto 30px; display: flex; justify-content: center; align-items: center;
        }

        svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: rotate(-90deg); }
        circle { fill: none; stroke-width: 8; stroke-linecap: round; }
        .circle-bg { stroke: rgba(255, 255, 255, 0.05); }

        .circle-progress {
            stroke: #00ff88;
            stroke-dasharray: 816; stroke-dashoffset: 0;
            /* Transiciones suaves para el color y el movimiento */
            transition: stroke-dashoffset 1s linear, stroke 0.8s ease, filter 0.8s ease;
            filter: drop-shadow(0 0 5px rgba(0, 255, 136, 0.5));
        }

        /* Texto del Reloj */
        .timer-text {
            position: absolute; display: flex; flex-direction: column; align-items: center;
        }

        .status-text {
            font-size: 0.8rem; text-transform: uppercase; letter-spacing: 3px;
            margin-bottom: 5px; color: #888;
            transition: color 0.8s ease; /* Transici√≥n de color de texto */
        }

        .time-digits {
            font-family: 'Share Tech Mono', monospace;
            font-size: 4.5rem; line-height: 1; color: white;
            text-shadow: 0 0 20px rgba(255,255,255,0.2);
            /* Transici√≥n para el efecto de desvanecimiento (fade) */
            transition: opacity 0.5s ease; 
            opacity: 1;
        }
        
        /* Clase para ocultar los n√∫meros suavemente */
        .digits-hidden { opacity: 0; }

        /* --- BOTONERA --- */
        .controls { display: flex; justify-content: center; gap: 12px; margin-bottom: 30px; }
        .btn {
            padding: 12px 20px; border: none; border-radius: 12px;
            cursor: pointer; font-weight: 700; font-size: 0.8rem; text-transform: uppercase;
            transition: all 0.2s; color: white; display: flex; align-items: center; gap: 8px;
        }
        .btn:active { transform: scale(0.95); }
        .btn-play { background: #00ff88; color: #000; box-shadow: 0 0 15px rgba(0, 255, 136, 0.3); }
        .btn-play:hover { background: #5cffb1; }
        .btn-pause { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.1); }
        .btn-pause:hover { background: rgba(255, 255, 255, 0.2); }
        .btn-reset { background: rgba(255, 50, 50, 0.15); color: #ff5555; }
        .btn-reset:hover { background: rgba(255, 50, 50, 0.25); }

        /* --- INPUTS --- */
        .settings {
            border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;
            display: flex; justify-content: space-between; gap: 10px;
        }
        .input-group { text-align: center; }
        .input-group label { display: block; font-size: 0.65rem; color: #666; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px;}
        .time-editor {
            display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.4); padding: 5px 8px; border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        input[type=number] {
            background: transparent; border: none; color: white;
            font-family: 'Share Tech Mono'; font-size: 1.1rem;
            width: 30px; text-align: center;
        }
        input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
        .cycles-input { width: 40px !important; color: #ff9800 !important; }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }
        .modal-box {
            background: #151515; padding: 40px; border-radius: 20px;
            border: 1px solid #333; text-align: center;
            box-shadow: 0 0 50px rgba(0,210,255,0.2);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; }}
        .modal-btn { 
            margin-top: 20px; padding: 12px 30px; background: #00d2ff; border: none; 
            border-radius: 8px; font-weight: bold; cursor: pointer; color: #000;
        }
    </style>
</head>
<body>

    <div class="dashboard" id="dashboard">
        <div class="timer-container">
            <svg>
                <circle cx="140" cy="140" r="130" class="circle-bg"></circle>
                <circle cx="140" cy="140" r="130" class="circle-progress" id="progressRing"></circle>
            </svg>
            <div class="timer-text">
                <div class="status-text" id="statusText">TRABAJO</div>
                <div class="time-digits" id="timerDigits">25:00</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-play" onclick="startTimer()"><span>‚ñ∂</span> Iniciar</button>
            <button class="btn btn-pause" onclick="pauseTimer()"><span>‚è∏</span> Pausar</button>
            <button class="btn btn-reset" onclick="resetTimer()"><span>‚Üª</span> Reset</button>
        </div>

        <div class="settings">
            <div class="input-group">
                <label>Trabajo</label>
                <div class="time-editor">
                    <input type="number" id="wMin" value="25" placeholder="00"><span style="color:#666">:</span><input type="number" id="wSec" value="00" placeholder="00">
                </div>
            </div>
            <div class="input-group">
                <label>Descanso</label>
                <div class="time-editor">
                    <input type="number" id="bMin" value="5" placeholder="00"><span style="color:#666">:</span><input type="number" id="bSec" value="00" placeholder="00">
                </div>
            </div>
            <div class="input-group">
                <label style="color: #ff9800;">Ciclos</label>
                <div class="time-editor" style="border-color: rgba(255, 152, 0, 0.3);">
                    <input type="number" id="cyclesInput" class="cycles-input" value="1" min="1">
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="endModal">
        <div class="modal-box">
            <div style="font-size: 3rem; margin-bottom: 15px;">üöÄ</div>
            <h2 style="color:white; margin-bottom:10px;">SESI√ìN COMPLETADA</h2>
            <p style="color:#888;">Has terminado todos los ciclos.<br>¬°Gran esfuerzo!</p>
            <button class="modal-btn" onclick="closeModal()">NUEVO OBJETIVO</button>
        </div>
    </div>

    <script>
        let timerInterval = null;
        let timeLeft = 0;
        let totalTime = 0;
        let isWorkMode = true;
        let currentCycle = 1;
        let totalCycles = 1;

        const timerDigits = document.getElementById('timerDigits'); // Referencia al elemento de los n√∫meros
        const statusText = document.getElementById('statusText');
        const progressRing = document.getElementById('progressRing');
        const dashboard = document.getElementById('dashboard');
        const wMin = document.getElementById('wMin'); const wSec = document.getElementById('wSec');
        const bMin = document.getElementById('bMin'); const bSec = document.getElementById('bSec');
        const cyclesInput = document.getElementById('cyclesInput');

        const circumference = 2 * Math.PI * 130;
        progressRing.style.strokeDasharray = `${circumference} ${circumference}`;

        function init() { resetTimer(); }

        function loadTimeFromInputs() {
            if (isWorkMode) {
                timeLeft = (parseInt(wMin.value || 0) * 60) + parseInt(wSec.value || 0);
                setTheme('#00ff88', `TRABAJO (${currentCycle}/${totalCycles})`);
                dashboard.classList.remove('break-mode');
            } else {
                timeLeft = (parseInt(bMin.value || 0) * 60) + parseInt(bSec.value || 0);
                setTheme('#00d2ff', `DESCANSO (${currentCycle}/${totalCycles})`);
                dashboard.classList.add('break-mode');
            }
            totalTime = timeLeft;
        }

        function setTheme(color, text) {
            progressRing.style.stroke = color;
            progressRing.style.filter = `drop-shadow(0 0 5px ${color})`;
            statusText.textContent = text;
            statusText.style.color = color;
        }

        function updateDisplay() {
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            const timeString = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            timerDigits.textContent = timeString;
            document.title = `(${timeString}) ${isWorkMode ? 'Trabajo' : 'Descanso'}`;
        }

        function updateProgress() {
            if (totalTime > 0) {
                const offset = circumference - (timeLeft / totalTime) * circumference;
                progressRing.style.strokeDashoffset = offset;
            }
        }

        function startTimer() {
            totalCycles = parseInt(cyclesInput.value) || 1;
            if (timerInterval) return; 
            if (timeLeft === 0) loadTimeFromInputs();
            if(isWorkMode) setTheme('#00ff88', `TRABAJO (${currentCycle}/${totalCycles})`);

            // Asegurar que los d√≠gitos son visibles al arrancar
            timerDigits.classList.remove('digits-hidden');

            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateDisplay();
                    updateProgress();
                } else {
                    handleCycleEndFluid(); // Usamos la nueva funci√≥n fluida
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
        }

        function resetTimer() {
            pauseTimer();
            isWorkMode = true;
            currentCycle = 1;
            totalCycles = parseInt(cyclesInput.value) || 1;
            loadTimeFromInputs();
            updateDisplay();
            progressRing.style.strokeDashoffset = 0;
            statusText.textContent = "LISTO"; 
            statusText.style.color = "white";
            progressRing.style.stroke = "white";
            progressRing.style.filter = "none";
            dashboard.classList.remove('break-mode');
            timerDigits.classList.remove('digits-hidden'); // Asegurar visibilidad
        }

        // --- NUEVA FUNCI√ìN DE TRANSICI√ìN FLUIDA ---
        function handleCycleEndFluid() {
            clearInterval(timerInterval);
            timerInterval = null;
            playBeep();

            // 1. Ocultar los n√∫meros suavemente (Fade Out)
            timerDigits.classList.add('digits-hidden');

            // 2. Cambiar los colores del tema (Anillo y Texto) mientras los n√∫meros est√°n ocultos
            if (isWorkMode) {
                setTheme('#00d2ff', `DESCANSO (${currentCycle}/${totalCycles})`);
                dashboard.classList.add('break-mode');
            } else {
                 if (currentCycle < totalCycles) {
                    setTheme('#00ff88', `TRABAJO (${currentCycle + 1}/${totalCycles})`);
                    dashboard.classList.remove('break-mode');
                 }
            }
            
            // 3. Esperar a que termine la transici√≥n de color y el fade out (aprox 1.2s)
            setTimeout(() => {
                if (isWorkMode) {
                    // Fin Trabajo -> Cargar Descanso
                    isWorkMode = false;
                    loadTimeFromInputs();
                    updateDisplay(); // Muestra el nuevo tiempo (a√∫n oculto)
                    timerDigits.classList.remove('digits-hidden'); // Fade In
                    startTimer(); // Arrancar

                } else {
                    // Fin Descanso
                    if (currentCycle < totalCycles) {
                        // Siguiente ciclo
                        currentCycle++;
                        isWorkMode = true;
                        loadTimeFromInputs();
                        updateDisplay();
                        timerDigits.classList.remove('digits-hidden'); // Fade In
                        startTimer();
                    } else {
                        // Fin total
                        timerDigits.classList.remove('digits-hidden'); // Mostrar 00:00 final
                        document.getElementById('endModal').style.display = 'flex';
                        isWorkMode = true; currentCycle = 1; loadTimeFromInputs();
                    }
                }
            }, 1200); // Tiempo de espera para la transici√≥n fluida
        }

        function closeModal() {
            document.getElementById('endModal').style.display = 'none';
            resetTimer();
        }

        function playBeep() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator(); const gain = ctx.createGain();
                osc.connect(gain); gain.connect(ctx.destination);
                osc.type = 'sine';
                osc.frequency.setValueAtTime(isWorkMode ? 880 : 440, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                osc.start(); osc.stop(ctx.currentTime + 0.5);
            } catch(e) {}
        }

        [wMin, wSec, bMin, bSec, cyclesInput].forEach(input => {
            input.addEventListener('change', () => {
                if (!timerInterval) {
                    totalCycles = parseInt(cyclesInput.value) || 1;
                    loadTimeFromInputs();
                    updateDisplay();
                    progressRing.style.strokeDashoffset = 0;
                    statusText.textContent = "LISTO"; 
                    statusText.style.color = "white";
                    progressRing.style.stroke = "white";
                    timerDigits.classList.remove('digits-hidden');
                }
            });
        });

        init();
    </script>
</body>
</html>